version: '3.9'
services:
  api:
    build:
      context: . # This will use the Dockerfile in the current directory
    image: kommo-bot
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
    environment:
      # Gemini API key should be set via GEMINI_API_KEY environment variable
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    # The 'deploy' key configures resource allocation. The syntax below is for
    # enabling GPU access with Docker Compose, assuming nvidia-container-toolkit is installed.
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]